{% extends "base.html" %}

{% block content %}
<div>
    {% if current_user.group_id %}
        <!-- Usuario pertenece a un grupo -->
        <div class="bg-indigo-100 border border-indigo-300 rounded-xl p-6 mb-8 shadow-inner">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Perteneces al Grupo: <span class="text-indigo-900">{{ group.code }}</span></h2>

            <p class="text-lg text-gray-700 mb-4">Personas en tu grupo:</p>
            <ul class="space-y-2 list-disc list-inside ml-4">
                {% for member in members %}
                    <li class="text-gray-800">
                        {{ member.name }}
                        {% if member.id == current_user.id %}
                            <span class="text-xs font-semibold text-indigo-600">(Tú)</span>
                        {% endif %}
                        {% if member.is_group_responsible%}
                            <span class="text-xs font-semibold text-indigo-600">(Responsable)</span>
                        {% endif %}
                        <span class="text-sm text-gray-500"> - {{ member.email }}</span>
                        <span class="text-sm text-gray-500"> - {{ member.phone }}</span>
                    </li>
                {% endfor %}
            </ul>

            <!-- Opciones de Salida/Eliminación -->
            {% if current_user.is_group_responsible %}
                <form method="POST" action="{{ url_for('delete_group') }}" onsubmit="return confirm('¿Estás seguro de que deseas eliminar el grupo?');" class="mt-6">
                    <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150">
                        Eliminar Grupo
                    </button>
                </form>
            {% else %}
                <form method="POST" action="{{ url_for('leave_group') }}" onsubmit="return confirm('¿Estás seguro de que deseas salir del grupo?');" class="mt-6">
                    <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150">
                        Salir del Grupo
                    </button>
                </form>
            {% endif %}
        </div>

    {% else %}
        <!-- Usuario no pertenece a ningún grupo -->
        <div class="mb-10 p-6 border border-gray-200 rounded-xl">
            <h2 class="text-xl font-bold text-gray-800 mb-4">1. Crear un Nuevo Grupo</h2>
            <p class="text-gray-600 mb-4">Si no tienes un código de grupo, puedes crear uno nuevo. El nombre del grupo será tu código.</p>
            <p class="text-gray-600 mb-4">Al crear un grupo, serás el responsable y no podrás salir a menos que lo elimines.</p>
            <p class="text-gray-600 mb-4">Esto nos ayudará a tener un mejor control de las personas que requieren hospedaje y vienen en grupo.</p>

            <form method="POST" action="{{ url_for('create_group') }}" onsubmit="return confirm('Tú serás el Responsable del grupo ¿Estás seguro?');" class="mt-6">
                <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150">
                    Crear Nuevo Grupo
                </button>
            </form>
        </div>

        <div class="p-6 border border-gray-200 rounded-xl">
            <h2 class="text-xl font-bold text-gray-800 mb-4">2. Unirse a un Grupo Existente</h2>
            <p class="text-gray-600 mb-4">Ingresa el código del grupo al que deseas unirte:</p>

            <form method="POST" action="{{ url_for('join_group') }}" class="flex flex-col sm:flex-row gap-3">
                <input name="code" type="text" placeholder="Ingresa el código aquí (Ej: A1B2C3)" required class="flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 uppercase">
                <button type="submit" class="shrink-0 px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                    Unirse al Grupo
                </button>
            </form>
        </div>
    {% endif %}
</div>

<script>
    // Este script debe ser manejado por un modal personalizado,
    // pero por simplicidad se mantiene el confirm original en el onsubmit.
    // En un entorno de producción, se usaría un modal/alerta personalizado.
</script>
{% endblock %}